# Контейнер для запуска бд

Для запуска:

1. Положить SQL скрипты в папку sql
2. Запустить контейнер
```bash
docker-composer up
```

## Тестирования

Выбор всех пользователей:

```sql
SELECT * FROM users;
```

Выбор пользователя по имени:

```sql
SELECT * FROM users WHERE name = 'Alice';
```

Добавление нового пользователя:
```sql
INSERT INTO users (name, email, age) VALUES ('David', 'david@email.com', 32);
```

Обновление возраста пользователя:
```sql
UPDATE users SET age = 29 WHERE name = 'Alice';
```

Удаление пользователя по имени:
```sql
DELETE FROM users WHERE name = 'Bob';
```
## Тестирования реплики

1. Проверить состояние репликации на мастере

```sql
SELECT * FROM pg_stat_replication;
```
Этот запрос вернёт информацию о подключенных к мастеру репликах. Если запрос не возвращает строк, значит, ни одна реплика не подключена.

2. Проверить последние переданные WAL-записи на мастере:

```sql
SELECT pg_current_wal_lsn();
```
Этот запрос покажет последний LSN (Log Sequence Number) на мастере.

3. Проверить последние полученные WAL-записи на реплике:

```sql
SELECT pg_last_wal_receive_lsn();
```
Этот запрос вернёт последний полученный LSN на реплике. Сравнив этот LSN с LSN на мастере, вы можете определить, насколько "отстаёт" реплика.

4. Проверить, находится ли сервер в режиме реплики:

```sql
SELECT pg_is_in_recovery();
```

Этот запрос вернёт true, если сервер работает в режиме реплики (слейва), и false, если он мастер.

5. Проверить, находится ли сервер в режиме реплики:

```sql
SELECT * FROM pg_replication_slots;
```
Репликационные слоты предоставляют информацию о том, какие WAL-записи должны быть сохранены для реплик, даже если они уже были применены на мастере.

6. Проверить размер репликационного лага:
```sql
SELECT pg_current_wal_lsn() - pg_last_wal_replay_lsn() AS replication_lag;
```

Если replication_lag растёт со временем, это может указывать на проблемы с репликацией.